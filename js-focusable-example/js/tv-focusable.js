var __extends=this&&this.__extends||function(){var p=function(h,a){p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,c){b.__proto__=c}||function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d])};return p(h,a)};return function(h,a){function b(){this.constructor=h}p(h,a);h.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)}}();
(function(){if("function"===typeof window.CustomEvent)return!1;var p=function(h,a){a=a||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(h,a.bubbles,a.cancelable,a.detail);return b};p.prototype=window.Event.prototype;window.CustomEvent=p})();
var initData={KEYS:{KEY_LEFT:[37,21],KEY_UP:[38,19],KEY_RIGHT:[39,22],KEY_DOWN:[40,20],KEY_ENTER:[13,23]},scrollEl:null,focusClassName:"focus",initDis:20,longPressTime:500,findFocusType:1,distanceToCenter:!1,offsetDistance:50,limitingEl:null},eventType={LEFT:"left",UP:"up",RIGHT:"right",DOWN:"down"},itemAttrname="focusable",focusedAttrname="focused",leftEvent={type:eventType.LEFT,event:new CustomEvent(eventType.LEFT,{detail:{}})},rightEvent={type:eventType.RIGHT,event:new CustomEvent(eventType.RIGHT,
{detail:{}})},upEvent={type:eventType.UP,event:new CustomEvent(eventType.UP,{detail:{}})},downEvent={type:eventType.DOWN,event:new CustomEvent(eventType.DOWN,{detail:{}})},FocusData=function(){return function(){this._KEYS=initData.KEYS;this._scrollEl=initData.scrollEl;this._focusClassName=initData.focusClassName;this._initDis=initData.initDis;this._findFocusType=initData.findFocusType;this._offsetDistance=initData.offsetDistance;this._longPressTime=initData.longPressTime;this._limitingEl=initData.limitingEl;
this._distanceToCenter=initData.distanceToCenter;this.eventDisabled="";this.focusOriginalEl=this.focusOriginalSize=this.lastOpt=this.scrollTimer=null}}(),FocusUtils=function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a.hasClass=function(b,c){return b.classList.contains(c)};a.toggleClass=function(b,c){return b.classList.toggle(c)};a.getParentTag=function(b,c){void 0===c&&(c=[]);return b instanceof HTMLElement?"BODY"!==b.parentElement.nodeName?(c.push(b.parentElement),a.getParentTag(b.parentElement,
c)):c:console.error("receive only HTMLElement")};a.parentShow=function(b){return 0===a.getParentTag(b).filter(function(c){return"none"===window.getComputedStyle(c).display}).length?!0:!1};a.removeOneClassName=function(b,c){b&&a.hasClass(b,c)&&a.toggleClass(b,c)};a.getElementByPath=function(b){return document.evaluate(b,document).iterateNext()};a.getElementsByPath=function(b){b=document.evaluate(b,document,null,XPathResult.ANY_TYPE,null);var c=[],d=b.iterateNext();for(d&&c.push(d);d;)(d=b.iterateNext())&&
c.push(d);return c};a.addClassName=function(b,c){b&&a.toggleClass(b,c)};a.addAttrName=function(b,c){a.focusOriginalEl!==b&&(a.focusOriginalSize=b.getBoundingClientRect(),a.focusOriginalEl=b);var d=document.querySelector("["+focusedAttrname+"]");d&&(d.removeAttribute(c),a.removeOneClassName(d,a._focusClassName));b.setAttribute(c,"");c===focusedAttrname&&(a.addClassName(b,a._focusClassName),b.dispatchEvent(new CustomEvent("onFocus",{detail:{el:b}})))};a.inNode=function(b,c){return c!==b&&c.contains(b)};
a.preventDefault=function(b){b=b||window.event;b.preventDefault&&b.preventDefault();b.returnValue=!1};a.onEvent=function(b,c,d){return b.dispatchEvent(new CustomEvent(c,{detail:d}))};a.offEvent=function(b,c,d,f){void 0===f&&(f=!1);return b.removeEventListener(c,d,f)};return a}__extends(h,p);h.prototype.Scroll2=function(a){var b=this;if(!a.time)return a.setNumFn&&a.setNumFn(a.number),a.number;null!=this.scrollTimer&&(clearInterval(this.scrollTimer),this.lastOpt.setNumFn&&this.lastOpt.setNumFn(this.lastOpt.number));
this.lastOpt=a;var c=a.time/20,d=0;a.getNumFn&&(d=a.getNumFn());var f=(a.number-d)/c;this.scrollTimer=setInterval(function(){0<c?(c--,b.Scroll2({number:d+=f,getNumFn:a.getNumFn,setNumFn:a.setNumFn})):(clearInterval(b.scrollTimer),b.scrollTimer=null,b.lastOpt=null)},20)};return h}(FocusData),FocusCore=function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a.keyEvent=function(b,c){a.eventDisabled="event";c.dispatchEvent(b.event);c.dispatchEvent(new CustomEvent("onBlur",{detail:{el:c}}));
"eventSkip"===a.eventDisabled?a.eventDisabled="":a.setFocus(b.type)};a.setFocus=function(b){var c=a.getNextFocusElement(b);document.querySelector(""+focusedAttrname);null!==c&&"none"!==window.getComputedStyle(c).display&&a.parentShow(c)&&null===c.getAttribute("focusdisable")&&(c&&a.addAttrName(c,focusedAttrname),a.doScroll(c,!0,b))};a.scrollFn=function(b,c,d){void 0===d&&(d=!0);a.Scroll2({number:b,time:d?200:0,getNumFn:function(){if("scrollTop"===c)return a._scrollEl?a._scrollEl.scrollTop:document.body.scrollTop||
document.documentElement.scrollTop||window.pageYOffset;if("scrollLeft"===c)return a._scrollEl?a._scrollEl.scrollLeft:document.body.scrollLeft||document.documentElement.scrollLeft||window.pageXOffset},setNumFn:function(f){"scrollTop"===c&&(a._scrollEl?a._scrollEl.scrollTop=f:document.body.scrollTop=document.documentElement.scrollTop=f);"scrollLeft"===c&&(a._scrollEl?a._scrollEl.scrollLeft=f:document.body.scrollLeft=document.documentElement.scrollLeft=f)}})};a.doScroll=function(b,c,d){void 0===c&&(c=
!0);b=b&&b.length&&b[0]||b;if((!a._scrollEl||a.inNode(b,a._scrollEl))&&b){b=b.getBoundingClientRect();if(a._scrollEl){var f=a._scrollEl.scrollTop;var k=a._scrollEl.scrollLeft;var l=a._scrollEl.getBoundingClientRect();var v=l.height;var g=l.width;var q=b.left-l.left;l=b.top-l.top}else f=document.body.scrollTop||document.documentElement.scrollTop||window.pageXOffset,k=document.body.scrollLeft||document.documentElement.scrollLeft||window.pageYOffset,g=document.documentElement.clientWidth||document.body.clientWidth,
v=document.documentElement.clientHeight||document.body.clientHeight,q=b.left,l=b.top;var m=g/2,u=v/2,w=q+b.width/2,x=l+b.height/2;a._distanceToCenter?"down"===d||"up"===d?a.scrollFn(x+f-u,"scrollTop",c):"left"===d||"right"===d?a.scrollFn(w+k-m,"scrollLeft",c):b.top>b.left?(a.scrollFn(w+k-m,"scrollLeft",c),a.scrollFn(x+f-u,"scrollTop",c)):(a.scrollFn(x+f-u,"scrollTop",c),a.scrollFn(w+k-m,"scrollLeft",c)):(d=l+b.height,d>v&&(d=d-v+f+a._offsetDistance,a.scrollFn(d,"scrollTop",c)),0>l&&(d=l+f-a._offsetDistance,
a.scrollFn(d,"scrollTop",c)),d=q+b.width,d>g&&(d=d-g+k+a._offsetDistance,a.scrollFn(d,"scrollLeft",c)),0>q&&(d=q+k-a._offsetDistance,a.scrollFn(d,"scrollLeft",c)))}};a.calLineEl=function(b,c,d,f,k,l,v){if(1===l)return!1;l=0;if(b===eventType.UP||b===eventType.DOWN)l=c;else if(b===eventType.RIGHT||b===eventType.LEFT)l=d;l<=v&&(b=Math.min(c+d,f.dis),b!=f.dis&&(f.dis=b,f.el=k));return f};a.getNextFocusElement=function(b){var c=document.querySelectorAll("["+itemAttrname+"]"),d=document.querySelectorAll("["+
focusedAttrname+"]");if(!c||!c.length)return null;var f=null,k=Number.MAX_VALUE,l=Number.MAX_VALUE,v={el:null,dis:Number.MAX_VALUE,absDis:Number.MAX_VALUE};if(d.length)d=d[d.length-1];else return d=c[0],a.addAttrName(d,focusedAttrname),d;var g=d.getBoundingClientRect(),q=(g.width-d.offsetWidth)/2,m=(g.height-d.offsetHeight)/2,u=d=0,w=0,x=0,t=[g.top+m,g.right-q,g.bottom-m,g.left+q];b===eventType.UP&&(d=g.left+g.width/2,u=Math.round(g.bottom-m),w=g.left+q,x=g.left+g.width-q);b===eventType.RIGHT&&(u=
g.top+g.height/2,d=Math.round(g.left+q),w=g.top+m,x=g.top+g.height-m);b===eventType.DOWN&&(d=g.left+g.width/2,u=Math.round(g.top+m),w=g.left+q,x=g.left+g.width-q);b===eventType.LEFT&&(u=g.top+g.height/2,d=Math.round(g.right-q),w=g.top+m,x=g.top+g.height-m);g=!1;for(q=0;q<c.length;q++){m=c[q];var e=m.getBoundingClientRect(),y=0,r=0,n=0,z=0;if(document.querySelector("."+a._focusClassName)!==m){if(b===eventType.UP){r=e.top+e.height;if((e.right<t[3]||e.left>t[1])&&e.bottom>t[0])continue;if(Math.round(r)>=
u)continue;y=e.left+e.width/2;n=e.left;z=e.left+e.width}else if(b===eventType.RIGHT){y=e.left;if((e.bottom<t[0]||e.top>t[2])&&e.left<t[1])continue;if(Math.round(y)<=d)continue;r=e.top+e.height/2;n=e.top;z=e.top+e.height}else if(b===eventType.DOWN){r=e.top;if((e.right<t[3]||e.left>t[1])&&e.top<t[2])continue;if(Math.round(r)<=u)continue;y=e.left+e.width/2;n=e.left;z=e.left+e.width}else if(b===eventType.LEFT){y=e.left+e.width;if((e.bottom<t[0]||e.top>t[2])&&e.right>t[3])continue;if(Math.round(y)>=d)continue;
r=e.top+e.height/2;n=e.top;z=e.top+e.height}e=Math.abs(d-y);r=Math.abs(u-r);a.calLineEl(b,e,r,v,m,a._findFocusType,a._initDis);if(w<=z&&x>=n){g=!0;n=0;if(b===eventType.UP||b===eventType.DOWN)n=r;else if(b===eventType.RIGHT||b===eventType.LEFT)n=e;l===n?(n=Math.min(Math.sqrt(e*e+r*r),k),n!=k&&(k=n,f=m)):(n=Math.min(l,n),n!=l&&(l=n,k=Math.min(Math.sqrt(e*e+r*r),k),f=m))}else g||(n=Math.min(Math.sqrt(e*e+r*r),k),n!=k&&(k=n,f=m))}}return 1===a._findFocusType?f:v.el||f};return a}__extends(h,p);return h}(FocusUtils),
timerNum=0,timer=null,timerFirst=0,FocusAble=function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a.focusKeyUpEvent=function(b){var c=window.event?window.event.keyCode:b.which,d=document.querySelectorAll("["+itemAttrname+"]");if(d.length){var f=document.querySelectorAll("["+focusedAttrname+"]");d=f.length?f[f.length-1]:d[0];-1!==a._KEYS.KEY_ENTER.indexOf(c)&&(clearTimeout(timer),0===timerNum&&(a.preventDefault(b),d.click(),timerNum=0))}timerNum=timerFirst=0};a.focusKeyDownEvent=
function(b){var c=window.event?window.event.keyCode:b.which,d=document.querySelectorAll("["+itemAttrname+"]");if(d.length){var f=document.querySelectorAll("["+focusedAttrname+"]"),k=f.length?f[f.length-1]:d[0];-1!==a._KEYS.KEY_ENTER.indexOf(c)?0===timerFirst&&(timerFirst=1,timer=setTimeout(function(){timerNum++;k.dispatchEvent(new CustomEvent("longPress",{detail:{el:k}}));clearTimeout(timer)},a._longPressTime)):-1!==a._KEYS.KEY_LEFT.indexOf(c)?(a.preventDefault(b),a.keyEvent(leftEvent,k)):-1!==a._KEYS.KEY_UP.indexOf(c)?
(a.preventDefault(b),a.keyEvent(upEvent,k)):-1!==a._KEYS.KEY_DOWN.indexOf(c)?(a.preventDefault(b),a.keyEvent(downEvent,k)):-1!==a._KEYS.KEY_RIGHT.indexOf(c)&&(a.preventDefault(b),a.keyEvent(rightEvent,k))}};a.init=function(b){a._focusClassName=b.focusClassName||a._focusClassName;a._initDis=b.initDis||a._initDis;a._findFocusType=void 0===b.findFocusType?a._findFocusType:b.findFocusType;a._KEYS.KEY_UP=b.KEYS&&b.KEYS.KEY_UP||a._KEYS.KEY_UP;a._KEYS.KEY_RIGHT=b.KEYS&&b.KEYS.KEY_RIGHT||a._KEYS.KEY_RIGHT;
a._KEYS.KEY_DOWN=b.KEYS&&b.KEYS.KEY_DOWN||a._KEYS.KEY_DOWN;a._KEYS.KEY_LEFT=b.KEYS&&b.KEYS.KEY_LEFT||a._KEYS.KEY_LEFT;a._KEYS.KEY_ENTER=b.KEYS&&b.KEYS.KEY_ENTER||a._KEYS.KEY_ENTER;a._offsetDistance=void 0===b.offsetDistance?a._offsetDistance:b.offsetDistance;a._longPressTime=void 0===b.longPressTime?a._longPressTime:b.longPressTime;a._distanceToCenter=void 0===b.distanceToCenter?a._distanceToCenter:b.distanceToCenter};a.requestFocus=function(b,c){void 0===c&&(c=!0);a.eventDisabled=a.eventDisabled?
"eventSkip":"initSkip";b=b&&b.length&&b[0]||b;if(!b)throw Error("Element not found!");b=b.$el||b;if(null!==b.getAttribute(focusedAttrname))return!1;for(var d=document.getElementsByClassName(a._focusClassName),f=0;f<d.length;f++)a.removeOneClassName(d[f],a._focusClassName);a.addAttrName(b,focusedAttrname);"initSkip"===a.eventDisabled?c?a.doScroll(b,c):setTimeout(function(){a.doScroll(b,c)},100):a.doScroll(b,c)};a.getElementByPath=a.getElementByPath;a.reset=function(){a._KEYS=initData.KEYS;a._scrollEl=
initData.scrollEl;a._focusClassName=initData.focusClassName;a._initDis=initData.initDis;a._findFocusType=initData.findFocusType;a._offsetDistance=initData.offsetDistance;a._longPressTime=initData.longPressTime;a._distanceToCenter=initData.distanceToCenter;a._limitingEl=initData.limitingEl};a.resetFocusClassName=function(){a._focusClassName=initData.focusClassName};a.resetInitDis=function(){a._initDis=initData.initDis};a.resetFindFocusType=function(){a._findFocusType=initData.findFocusType};a.resetKEYS=
function(){a._KEYS=initData.KEYS};a.resetTheDis=function(){a._offsetDistance=initData.offsetDistance};a.resetOffsetDistance=function(){a._offsetDistance=initData.offsetDistance};a.resetLongPressTime=function(){a._longPressTime=initData.longPressTime};a.resetDistanceToCenter=function(){a._distanceToCenter=initData.distanceToCenter};a.resetLimitingEl=function(){a._limitingEl=initData.limitingEl};a.resetScrollEl=function(){a._scrollEl=initData.scrollEl};a.setScrollEl=function(b){a._scrollEl=b||a._scrollEl};
return a}__extends(h,p);Object.defineProperty(h.prototype,"focusClassName",{get:function(){return this._focusClassName},set:function(a){this._focusClassName=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"initDis",{get:function(){return this._initDis},set:function(a){this._initDis=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"findFocusType",{get:function(){return this._findFocusType},set:function(a){this._findFocusType=a},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"KEYS",{get:function(){return this._KEYS},set:function(a){this._KEYS=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"offsetDistance",{get:function(){return this._offsetDistance},set:function(a){this._offsetDistance=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"longPressTime",{get:function(){return this._longPressTime},set:function(a){this._longPressTime=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"distanceToCenter",{get:function(){return this._distanceToCenter},set:function(a){this._distanceToCenter=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"limitingEl",{get:function(){return this._limitingEl},set:function(a){null!==a?(document.querySelectorAll("["+itemAttrname+"]").forEach(function(b){b.setAttribute("focusdisable","");b.removeAttribute(""+itemAttrname)}),a.querySelectorAll("[focusdisable]").forEach(function(b){b.setAttribute(""+itemAttrname,"");b.removeAttribute("focusdisable")})):
(document.querySelectorAll("["+itemAttrname+"]").forEach(function(b){b.removeAttribute("focusdisable")}),document.querySelectorAll("[focusdisable]").forEach(function(b){b.setAttribute(""+itemAttrname,"");b.removeAttribute("focusdisable")}));this._limitingEl=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"scrollEl",{get:function(){return this._scrollEl},set:function(a){this._scrollEl=a},enumerable:!0,configurable:!0});return h}(FocusCore),tvCore=new FocusAble;
document.removeEventListener("keydown",tvCore.focusKeyDownEvent,!1);document.addEventListener("keydown",tvCore.focusKeyDownEvent);document.removeEventListener("keyup",tvCore.focusKeyUpEvent,!1);document.addEventListener("keyup",tvCore.focusKeyUpEvent);