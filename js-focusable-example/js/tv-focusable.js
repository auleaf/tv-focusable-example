var __extends=this&&this.__extends||function(){var p=function(h,a){p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,c){b.__proto__=c}||function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d])};return p(h,a)};return function(h,a){function b(){this.constructor=h}p(h,a);h.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)}}();
(function(){if("function"===typeof window.CustomEvent)return!1;var p=function(h,a){a=a||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(h,a.bubbles,a.cancelable,a.detail);return b};p.prototype=window.Event.prototype;window.CustomEvent=p})();
var initData={KEYS:{KEY_LEFT:[37,21],KEY_UP:[38,19],KEY_RIGHT:[39,22],KEY_DOWN:[40,20],KEY_ENTER:[13,23]},scrollEl:null,focusClassName:"focus",initDis:20,longPressTime:500,findFocusType:1,distanceToCenter:!1,offsetDistance:50,limitingEl:null,formAutofocus:!0,focusableClassName:""},eventType={LEFT:"left",UP:"up",RIGHT:"right",DOWN:"down"},itemAttrname="focusable",focusedAttrname="focused",leftEvent={type:eventType.LEFT,event:new CustomEvent(eventType.LEFT,{detail:{}})},rightEvent={type:eventType.RIGHT,
event:new CustomEvent(eventType.RIGHT,{detail:{}})},upEvent={type:eventType.UP,event:new CustomEvent(eventType.UP,{detail:{}})},downEvent={type:eventType.DOWN,event:new CustomEvent(eventType.DOWN,{detail:{}})};
document.addEventListener("readystatechange",function(){"complete"==document.readyState&&(leftEvent={type:eventType.LEFT,event:new CustomEvent(eventType.LEFT,{detail:{}})},rightEvent={type:eventType.RIGHT,event:new CustomEvent(eventType.RIGHT,{detail:{}})},upEvent={type:eventType.UP,event:new CustomEvent(eventType.UP,{detail:{}})},downEvent={type:eventType.DOWN,event:new CustomEvent(eventType.DOWN,{detail:{}})})},!1);
var FocusData=function(){return function(){this._KEYS=initData.KEYS;this._scrollEl=initData.scrollEl;this._focusClassName=initData.focusClassName;this._initDis=initData.initDis;this._findFocusType=initData.findFocusType;this._offsetDistance=initData.offsetDistance;this._longPressTime=initData.longPressTime;this._limitingEl=initData.limitingEl;this._distanceToCenter=initData.distanceToCenter;this._formAutofocus=initData.formAutofocus;this._focusableClassName=initData.focusableClassName;this.eventDisabled=
"";this.focusOriginalEl=this.focusOriginalSize=this.lastOpt=this.scrollTimer=null}}(),FocusUtils=function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a.hasClass=function(b,c){return b.classList.contains(c)};a.toggleClass=function(b,c){return b.classList.toggle(c)};a.getParentTag=function(b,c){void 0===c&&(c=[]);return b instanceof HTMLElement?"BODY"!==b.parentElement.nodeName?(c.push(b.parentElement),a.getParentTag(b.parentElement,c)):c:console.error("receive only HTMLElement")};
a.parentShow=function(b){return 0===a.getParentTag(b).filter(function(c){return"none"===window.getComputedStyle(c).display}).length?!0:!1};a.removeOneClassName=function(b,c){b&&a.hasClass(b,c)&&a.toggleClass(b,c)};a.getElementByPath=function(b){return document.evaluate(b,document).iterateNext()};a.getElementsByPath=function(b){b=document.evaluate(b,document,null,XPathResult.ANY_TYPE,null);var c=[],d=b.iterateNext();for(d&&c.push(d);d;)(d=b.iterateNext())&&c.push(d);return c};a.readXPath=function(b){if(""!==
b.id)return'//*[@id="'+b.id+'"]';if(b==document.body)return"/html/"+b.tagName.toLowerCase();for(var c=1,d=b.parentNode.childNodes,e=0,l=d.length;e<l;e++){var k=d[e];if(k==b){if(b.parentNode)return a.readXPath(b.parentNode)+"/"+b.tagName.toLowerCase()+"["+c+"]"}else 1==k.nodeType&&k.tagName==b.tagName&&c++}};a.addClassName=function(b,c){b&&a.toggleClass(b,c)};a.addAttrName=function(b,c){a.focusOriginalEl!==b&&(a.focusOriginalSize=b.getBoundingClientRect(),a.focusOriginalEl=b);var d=document.querySelector("["+
focusedAttrname+"]");d&&(d.removeAttribute(c),d.dispatchEvent(new CustomEvent("onBlur",{detail:{el:d}})),d.dispatchEvent(new CustomEvent("on-blur",{detail:{el:d}})),a.removeOneClassName(d,a._focusClassName),a._formAutofocus&&("INPUT"===d.tagName.toLocaleUpperCase()||"SELECT"===d.tagName.toLocaleUpperCase()||"TEXTAREA"===d.tagName.toLocaleUpperCase())&&d.blur());b.setAttribute(c,"");c===focusedAttrname&&(a.addClassName(b,a._focusClassName),b.dispatchEvent(new CustomEvent("onFocus",{detail:{el:b}})),
b.dispatchEvent(new CustomEvent("on-focus",{detail:{el:b}})))};a.inNode=function(b,c){return c!==b&&c.contains(b)};a.preventDefault=function(b){b=b||window.event;b.preventDefault&&b.preventDefault();b.returnValue=!1};a.onEvent=function(b,c,d){return b.dispatchEvent(new CustomEvent(c,{detail:d}))};a.offEvent=function(b,c,d,e){void 0===e&&(e=!1);return b.removeEventListener(c,d,e)};return a}__extends(h,p);h.prototype.Scroll2=function(a){var b=this;if(!a.time)return a.setNumFn&&a.setNumFn(a.number),
a.number;null!=this.scrollTimer&&(clearInterval(this.scrollTimer),this.lastOpt.setNumFn&&this.lastOpt.setNumFn(this.lastOpt.number));this.lastOpt=a;var c=a.time/20,d=0;a.getNumFn&&(d=a.getNumFn());var e=(a.number-d)/c;this.scrollTimer=setInterval(function(){0<c?(c--,b.Scroll2({number:d+=e,getNumFn:a.getNumFn,setNumFn:a.setNumFn})):(clearInterval(b.scrollTimer),b.scrollTimer=null,b.lastOpt=null)},20)};return h}(FocusData),FocusCore=function(p){function h(){var a=null!==p&&p.apply(this,arguments)||
this;a.keyEvent=function(b,c){a.eventDisabled="event";c&&c.dispatchEvent(b.event);"eventSkip"===a.eventDisabled?a.eventDisabled="":a.setFocus(b.type)};a.setFocus=function(b){var c=a.getNextFocusElement(b);null!==c&&"none"!==window.getComputedStyle(c).display&&a.parentShow(c)&&null===c.getAttribute("focusdisable")&&(c&&(a.addAttrName(c,focusedAttrname),a._formAutofocus&&"SELECT"===c.tagName.toLocaleUpperCase()&&c.focus()),a.doScroll(c,!0,b))};a.scrollFn=function(b,c,d){void 0===d&&(d=!0);a.Scroll2({number:b,
time:d?200:0,getNumFn:function(){if("scrollTop"===c)return a._scrollEl?a._scrollEl.scrollTop:document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset;if("scrollLeft"===c)return a._scrollEl?a._scrollEl.scrollLeft:document.body.scrollLeft||document.documentElement.scrollLeft||window.pageXOffset},setNumFn:function(e){"scrollTop"===c&&(a._scrollEl?a._scrollEl.scrollTop=e:document.body.scrollTop=document.documentElement.scrollTop=e);"scrollLeft"===c&&(a._scrollEl?a._scrollEl.scrollLeft=
e:document.body.scrollLeft=document.documentElement.scrollLeft=e)}})};a.doScroll=function(b,c,d){void 0===c&&(c=!0);b=b&&b.length&&b[0]||b;if((!a._scrollEl||a.inNode(b,a._scrollEl))&&b){b=b.getBoundingClientRect();if(a._scrollEl){var e=a._scrollEl.scrollTop;var l=a._scrollEl.scrollLeft;var k=a._scrollEl.getBoundingClientRect();var v=k.height;var g=k.width;var q=b.left-k.left;k=b.top-k.top}else e=document.body.scrollTop||document.documentElement.scrollTop||window.pageXOffset,l=document.body.scrollLeft||
document.documentElement.scrollLeft||window.pageYOffset,g=document.documentElement.clientWidth||document.body.clientWidth,v=document.documentElement.clientHeight||document.body.clientHeight,q=b.left,k=b.top;var m=g/2,u=v/2,w=q+b.width/2,x=k+b.height/2;a._distanceToCenter?"down"===d||"up"===d?a.scrollFn(x+e-u,"scrollTop",c):"left"===d||"right"===d?a.scrollFn(w+l-m,"scrollLeft",c):b.top>b.left?(a.scrollFn(w+l-m,"scrollLeft",c),a.scrollFn(x+e-u,"scrollTop",c)):(a.scrollFn(x+e-u,"scrollTop",c),a.scrollFn(w+
l-m,"scrollLeft",c)):(d=k+b.height,d>v&&(d=d-v+e+a._offsetDistance,a.scrollFn(d,"scrollTop",c)),0>k&&(d=k+e-a._offsetDistance,a.scrollFn(d,"scrollTop",c)),d=q+b.width,d>g&&(d=d-g+l+a._offsetDistance,a.scrollFn(d,"scrollLeft",c)),0>q&&(d=q+l-a._offsetDistance,a.scrollFn(d,"scrollLeft",c)))}};a.calLineEl=function(b,c,d,e,l,k,v){if(1===k)return!1;k=0;if(b===eventType.UP||b===eventType.DOWN)k=c;else if(b===eventType.RIGHT||b===eventType.LEFT)k=d;k<=v&&(b=Math.min(c+d,e.dis),b!=e.dis&&(e.dis=b,e.el=l));
return e};a.getNextFocusElement=function(b){var c=document.querySelectorAll("["+itemAttrname+"]"),d=document.querySelectorAll("["+focusedAttrname+"]");if(!c||!c.length)return null;var e=null,l=Number.MAX_VALUE,k=Number.MAX_VALUE,v={el:null,dis:Number.MAX_VALUE,absDis:Number.MAX_VALUE};if(d.length)d=d[d.length-1];else return d=c[0];var g=d.getBoundingClientRect(),q=(g.width-d.offsetWidth)/2,m=(g.height-d.offsetHeight)/2,u=d=0,w=0,x=0,t=[g.top+m,g.right-q,g.bottom-m,g.left+q];b===eventType.UP&&(d=g.left+
g.width/2,u=Math.round(g.bottom-m),w=g.left+q,x=g.left+g.width-q);b===eventType.RIGHT&&(u=g.top+g.height/2,d=Math.round(g.left+q),w=g.top+m,x=g.top+g.height-m);b===eventType.DOWN&&(d=g.left+g.width/2,u=Math.round(g.top+m),w=g.left+q,x=g.left+g.width-q);b===eventType.LEFT&&(u=g.top+g.height/2,d=Math.round(g.right-q),w=g.top+m,x=g.top+g.height-m);g=!1;for(q=0;q<c.length;q++){m=c[q];var f=m.getBoundingClientRect(),y=0,r=0,n=0,z=0;if(document.querySelector("."+a._focusClassName)!==m){if(b===eventType.UP){r=
f.top+f.height;if((f.right<t[3]||f.left>t[1])&&f.bottom>t[0])continue;if(Math.round(r)>=u)continue;y=f.left+f.width/2;n=f.left;z=f.left+f.width}else if(b===eventType.RIGHT){y=f.left;if((f.bottom<t[0]||f.top>t[2])&&f.left<t[1])continue;if(Math.round(y)<=d)continue;r=f.top+f.height/2;n=f.top;z=f.top+f.height}else if(b===eventType.DOWN){r=f.top;if((f.right<t[3]||f.left>t[1])&&f.top<t[2])continue;if(Math.round(r)<=u)continue;y=f.left+f.width/2;n=f.left;z=f.left+f.width}else if(b===eventType.LEFT){y=f.left+
f.width;if((f.bottom<t[0]||f.top>t[2])&&f.right>t[3])continue;if(Math.round(y)>=d)continue;r=f.top+f.height/2;n=f.top;z=f.top+f.height}f=Math.abs(d-y);r=Math.abs(u-r);a.calLineEl(b,f,r,v,m,a._findFocusType,a._initDis);if(w<=z&&x>=n){g=!0;n=0;if(b===eventType.UP||b===eventType.DOWN)n=r;else if(b===eventType.RIGHT||b===eventType.LEFT)n=f;k===n?(n=Math.min(Math.sqrt(f*f+r*r),l),n!=l&&(l=n,e=m)):(n=Math.min(k,n),n!=k&&(k=n,l=Math.min(Math.sqrt(f*f+r*r),l),e=m))}else g||(n=Math.min(Math.sqrt(f*f+r*r),
l),n!=l&&(l=n,e=m))}}return 1===a._findFocusType?e:v.el||e};return a}__extends(h,p);return h}(FocusUtils),timerNum=0,timer=null,timerFirst=0,FocusAble=function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a.focusKeyUpEvent=function(b){var c=window.event?window.event.keyCode:b.which,d=document.querySelectorAll("["+itemAttrname+"]");if(d.length){var e=document.querySelectorAll("["+focusedAttrname+"]");d=e.length?e[e.length-1]:d[0];-1!==a._KEYS.KEY_ENTER.indexOf(c)&&(clearTimeout(timer),
0===timerNum&&(a.preventDefault(b),d.click(),a._formAutofocus&&("INPUT"===d.tagName.toLocaleUpperCase()||"TEXTAREA"===d.tagName.toLocaleUpperCase())&&d.focus(),timerNum=0))}timerNum=timerFirst=0};a.focusKeyDownEvent=function(b){var c=window.event?window.event.keyCode:b.which;if(document.querySelectorAll("["+itemAttrname+"]").length){var d=document.querySelectorAll("["+focusedAttrname+"]"),e=d.length?d[d.length-1]:null;-1!==a._KEYS.KEY_ENTER.indexOf(c)?0===timerFirst&&(timerFirst=1,timer=setTimeout(function(){timerNum++;
e.dispatchEvent(new CustomEvent("longPress",{detail:{el:e}}));e.dispatchEvent(new CustomEvent("long-press",{detail:{el:e}}));clearTimeout(timer)},a._longPressTime)):-1!==a._KEYS.KEY_LEFT.indexOf(c)?(a.preventDefault(b),a.keyEvent(leftEvent,e)):-1!==a._KEYS.KEY_UP.indexOf(c)?(a.preventDefault(b),a.keyEvent(upEvent,e)):-1!==a._KEYS.KEY_DOWN.indexOf(c)?(a.preventDefault(b),a.keyEvent(downEvent,e)):-1!==a._KEYS.KEY_RIGHT.indexOf(c)&&(a.preventDefault(b),a.keyEvent(rightEvent,e))}};a.init=function(b){a._focusClassName=
b.focusClassName||a._focusClassName;a._initDis=b.initDis||a._initDis;a._findFocusType=void 0===b.findFocusType?a._findFocusType:b.findFocusType;a._KEYS.KEY_UP=b.KEYS&&b.KEYS.KEY_UP||a._KEYS.KEY_UP;a._KEYS.KEY_RIGHT=b.KEYS&&b.KEYS.KEY_RIGHT||a._KEYS.KEY_RIGHT;a._KEYS.KEY_DOWN=b.KEYS&&b.KEYS.KEY_DOWN||a._KEYS.KEY_DOWN;a._KEYS.KEY_LEFT=b.KEYS&&b.KEYS.KEY_LEFT||a._KEYS.KEY_LEFT;a._KEYS.KEY_ENTER=b.KEYS&&b.KEYS.KEY_ENTER||a._KEYS.KEY_ENTER;a._offsetDistance=void 0===b.offsetDistance?a._offsetDistance:
b.offsetDistance;a._longPressTime=void 0===b.longPressTime?a._longPressTime:b.longPressTime;a._distanceToCenter=void 0===b.distanceToCenter?a._distanceToCenter:b.distanceToCenter;a._formAutofocus=void 0===b.formAutofocus?a._formAutofocus:b.formAutofocus;a._focusableClassName=void 0===b.focusableClassName?a._focusableClassName:b.focusableClassName;a.setFocusableAttr()};a.setFocusableAttr=function(){if(a._focusableClassName)for(var b=document.getElementsByClassName(a._focusableClassName)||[],c=0;c<
b.length;c++){var d=b[c];d.setAttribute("focusable","");-1!==(d.getAttribute("class")||"").split(" ").indexOf(a.focusClassName)&&d.setAttribute("focused","")}};a.requestFocus=function(b,c){void 0===c&&(c=!0);a.eventDisabled=a.eventDisabled?"eventSkip":"initSkip";b=b&&b.length&&b[0]||b;if(!b)throw Error("Element not found!");b=b.$el||b;if(b.hasAttribute("focusable")){if(null!==b.getAttribute(focusedAttrname))return!1;for(var d=document.getElementsByClassName(a._focusClassName),e=0;e<d.length;e++)a.removeOneClassName(d[e],
a._focusClassName);a.addAttrName(b,focusedAttrname);"initSkip"===a.eventDisabled?c?a.doScroll(b,c):setTimeout(function(){a.doScroll(b,c)},100):a.doScroll(b,c)}};a.getElementByPath=a.getElementByPath;a.reset=function(){a._KEYS=initData.KEYS;a._scrollEl=initData.scrollEl;a._focusClassName=initData.focusClassName;a._initDis=initData.initDis;a._findFocusType=initData.findFocusType;a._offsetDistance=initData.offsetDistance;a._longPressTime=initData.longPressTime;a._distanceToCenter=initData.distanceToCenter;
a._limitingEl=initData.limitingEl;a._formAutofocus=initData.formAutofocus;a._focusableClassName=initData.focusableClassName};a.resetFocusClassName=function(){a._focusClassName=initData.focusClassName};a.resetInitDis=function(){a._initDis=initData.initDis};a.resetFindFocusType=function(){a._findFocusType=initData.findFocusType};a.resetKEYS=function(){a._KEYS=initData.KEYS};a.resetTheDis=function(){a._offsetDistance=initData.offsetDistance};a.resetOffsetDistance=function(){a._offsetDistance=initData.offsetDistance};
a.resetLongPressTime=function(){a._longPressTime=initData.longPressTime};a.resetDistanceToCenter=function(){a._distanceToCenter=initData.distanceToCenter};a.resetFormAutofocus=function(){a._formAutofocus=initData.formAutofocus};a.resetFocusableClassName=function(){a._focusableClassName=initData.focusableClassName};a.resetLimitingEl=function(){a._limitingEl=initData.limitingEl};a.resetScrollEl=function(){a._scrollEl=initData.scrollEl};a.setScrollEl=function(b){a._scrollEl=b||a._scrollEl};return a}
__extends(h,p);Object.defineProperty(h.prototype,"focusClassName",{get:function(){return this._focusClassName},set:function(a){this._focusClassName=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"initDis",{get:function(){return this._initDis},set:function(a){this._initDis=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"findFocusType",{get:function(){return this._findFocusType},set:function(a){this._findFocusType=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"KEYS",{get:function(){return this._KEYS},set:function(a){this._KEYS=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"offsetDistance",{get:function(){return this._offsetDistance},set:function(a){this._offsetDistance=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"longPressTime",{get:function(){return this._longPressTime},set:function(a){this._longPressTime=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"distanceToCenter",{get:function(){return this._distanceToCenter},
set:function(a){this._distanceToCenter=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"formAutofocus",{get:function(){return this._formAutofocus},set:function(a){this._formAutofocus=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"focusableClassName",{get:function(){return this._focusableClassName},set:function(a){this._focusableClassName=a;this.setFocusableAttr()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"limitingEl",{get:function(){return this._limitingEl},
set:function(a){null!==a?(document.querySelectorAll("["+itemAttrname+"]").forEach(function(b){b.setAttribute("focusdisable","");b.removeAttribute(""+itemAttrname)}),a.querySelectorAll("[focusdisable]").forEach(function(b){b.setAttribute(""+itemAttrname,"");b.removeAttribute("focusdisable")})):(document.querySelectorAll("["+itemAttrname+"]").forEach(function(b){b.removeAttribute("focusdisable")}),document.querySelectorAll("[focusdisable]").forEach(function(b){b.setAttribute(""+itemAttrname,"");b.removeAttribute("focusdisable")}));
this._limitingEl=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"scrollEl",{get:function(){return this._scrollEl},set:function(a){this._scrollEl=a},enumerable:!0,configurable:!0});return h}(FocusCore),tvCore=new FocusAble;document.removeEventListener("keydown",tvCore.focusKeyDownEvent,!1);document.addEventListener("keydown",tvCore.focusKeyDownEvent);document.removeEventListener("keyup",tvCore.focusKeyUpEvent,!1);document.addEventListener("keyup",tvCore.focusKeyUpEvent);